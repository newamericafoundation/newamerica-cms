{% extends "program_base.html" %}

{% load wagtailcore_tags %}
{% load wagtailcore_tags wagtailimages_tags %}
{% load utilities %}

{% block body_class %}template-event{% endblock %}

{% block content %}
	{% image page.story_image min-1100x300 as story_image %}

	<div class="post-header-container">
		{% if story_image %}

			<div class="post-header with-image" style="background-image: linear-gradient(
			      rgba(0, 0, 0, 0.3),
			      rgba(0, 0, 0, 0.3)
			    ), 
		    	url({{ story_image.url }})">

				<div class="post-header__text">
			    	<h1 class="post-header__text__heading">{{ page.title }}</h1>
			    	{% if page.subheading %}
			    		<h2 class="post-header__text__subheading">{{ page.subheading }}</h2>
			    	{% endif %}
			    	{% if page.rsvp_link %}
			    		{% is_future page.date as is_date_future %}
			    		{% if is_date_future %}
			    			<a class="post-header__text__button button" href='{{page.rsvp_link}}'>RSVP</a>
			    		{% endif %}
			    	{% endif %}
				</div>
			</div>
			{% if story_image.image.source %}
				<div class="caption">Photo: {{ story_image.image.source}}</div>
			{% endif %}

		{% else %}

			<div class="post-header">
				<div class="post-header__text">
			    	<h1 class="post-header__text__heading">{{ page.title }}</h1>
			    	{% if page.subheading %}
			    		<h2 class="post-header__text__subheading">{{ page.subheading }}</h2>
			    	{% endif %}
			    	{% if page.rsvp_link %}
			    		{% is_future page.date as is_date_future %}
			    		{% if is_date_future %}
			    			<a class="post-header__text__button button" href='{{page.rsvp_link}}'>RSVP</a>
			    		{% endif %}
			    	{% endif %}
				</div>
			</div>

		{% endif %}
	</div>

	<div class="post-container">

		<div class="event row">
			<div class="event__left">
				<h3 class="event__heading">When</h3>
				{% generate_dateline page %}
			</div>
			<div class="event__right">
				<h3 class="event__heading">Where</h3>
				<p>{{ page.host_organization }}</p>
				<p>{{ page.street_address }}</p>
				<p>{{ page.city }}, {{ page.state }} {{ page.zipcode }}</p>
			</div>
		</div>
	     <div class="post-body with-dropcap">
		    {% for block in self.body %}
		    	<div class="block-{{ block.block_type }}">
			       {% if block.block_type == 'image' %}
		            	{{ block }}
		            	{% if block.value.caption or block.value.source %}
		            		<div class="caption">{{ block.value.caption }} {% if block.value.source %}({{ block.value.source }}){% endif %}</div>
		            	{% endif %}
			        {% else %}
			            {{ block }}
			        {% endif %}
		   		</div>
		    {% endfor %}

		    {% if page.soundcloud_url %}
		    	<a href='{{ page.soundcloud_url }}'>Listen to this Event</a>
		    {% endif %}
		</div>
	</div>

{% endblock %}
