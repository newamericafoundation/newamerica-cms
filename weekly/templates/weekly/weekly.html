{% extends "base.html" %}

{% load wagtailcore_tags %}
{% load wagtailimages_tags %}
{% load utilities %}

{% block body_class %}template-weekly{% endblock %}

{% block content %}
<div class="weekly">
	<div class="weekly__header">
		<div class="weekly__header__left">
			<a href="/weekly/">
				<h1 class="weekly__header__left__text">NEW<br>AMERICA<br>WEEKLY</h1>
			</a>
		</div>
		<div class="weekly__header__middle">
			<p class="weekly__header__middle__text">New America's weekly digital magazine, featuring the big ideas and innovative thinking to confront today's most pressing challenges. <a href="/subscribe/">Subscribe</a> today to receive the weekly every Thursday.</p>
		</div>
	</div>

	<div class="weekly__lead">
		{% with first_edition=all_posts.0 %}
			{% with first_story=first_edition.get_children.all.0 %}

			<div class="weekly__lead__image">
				<div class='hero-grid has-1-children'>
					<div class='hero-grid__main'>
						<div class='hero-grid__element'>
						<a href="{{ first_story.specific.url }}">
							<div class='hero-grid__element__wrapper'>
								{% image first_story.specific.story_image min-1300x500 as edition_image %}
								<div class='hero-grid__element__background' style='background-image: url({{ edition_image.url }})'></div>
								<div class='hero-grid__element__overlay'></div>
								<div class='hero-grid__element__text-bar'>
									<h5 class="hero-grid__element__text-bar__program"><a href="{{ first_edition.url }}">{{ first_edition.specific.title }}</a></h5>
									<h1 class='hero-grid__element__text-bar__heading'>{{ first_story.specific.title }}</h1>
									<p class= "hero-grid__element__text-bar__excerpt">{{ first_story.specific.story_excerpt }}</p>
								</div>
							</div>
						</a>
						</div>
					</div>
				</div>
			</div>

			<div class="weekly__lead__text">
				<div class="weekly__lead__text__content">
					{% if first_edition.get_children.all|length > 1 %}
						<h3 class="weekly__lead__text__title">Also in this Edition</h3>
					{% endif %}

					{% for story in first_edition.get_children.all|slice:"1:5" %}
						<div class="weekly__lead__text__item">
							<h3 class="weekly__lead__text__item__name"><a href="{{ story.url }}"> {{ story.title }}</a></h3>
							{% if story.specific.authors.all %}
								<h3 class="weekly__lead__text__item__description">{% generate_byline story.content_type story.specific.authors.all %}</h3>
							{% endif %}
						</div>
					{% endfor %}
				</div>
			</div>
		
			{% endwith %}
		{% endwith %}
	</div>

	<div class="picture-grid hide-first full-width">
	{% for edition in all_posts %}
		{% if edition.get_children|length > 0 %}
			{% with first_story=edition.get_children.all.0 %}

				<div class="picture-grid__entry">
					{% if first_story.specific.story_image %}
						{% image first_story.specific.story_image min-650x200 as edition_image %}
						<a href="{{ first_story.specific.url }}">
							<div class="picture-grid__entry__image-container" style="background-image: url('{{ edition_image.url }}') ">
							</div>
						</a>
						<div class="picture-grid__entry__text-container has-image">
					{% else %}
						<div class="picture-grid__entry__text-container">
					{% endif %}
							<h5 class="picture-grid__entry__description">
								<a href="{{ edition.url }}">{{ edition }}</a>
							</h5>
							<h5 class="picture-grid__entry__title">
								<a href="{{ first_story.specific.url }}">{{ first_story.specific.title }}</a>
							</h5>
							<hr class="picture-grid__entry__break">
							<p class="picture-grid__entry__body">
								{{ first_story.specific.story_excerpt }}
							</p>
							<a class="picture-grid__entry__button button" href="{{ first_story.specific.url }}">Read More</a>
							<div class="picture-grid__entry__text-fadeout"></div>
						</div>
					
					
				</div>
				<hr class="picture-grid__divider">
			{% endwith %}
		{% endif %}
	{% endfor %}
	</div>

	<div class="picture-grid__footer">
		<div class="pagination">
			{% if all_posts.has_previous %}
				<a class="pagination__arrow" href="?page={{ all_posts.previous_page_number }}">
					{% include 'components/svg/arrow-left.html' %}
				</a>
			{% endif %}

			<span>Page</span>
			<form class="pagination__form" action="?page=value" method="get">
				<input class="pagination__input" type="text" placeholder="{{ all_posts.number }}" name="page">
			</form>

			<span>of</span>
			<a href="?page={{ all_posts.paginator.num_pages|get_range|last }}">{{ all_posts.paginator.num_pages|get_range|last }}</a>

			{% if all_posts.has_next %}
		    	<a class="pagination__arrow" href="?page={{ all_posts.next_page_number }}">
		    		{% include 'components/svg/arrow-right.html' %}
				</a>
			{% endif %}
		</div>
	</div>
{% endblock %}